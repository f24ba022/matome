# Flutter 全まとめ集4

## データアクセスについて

Flutterアプリケーションにおけるデータアクセスは、アプリケーションの規模やデータの永続性要件によって様々なアプローチが存在します。以下に主要なデータアクセス方法とその特徴をまとめます。

## 1. 永続化ストレージ

アプリケーションが閉じられた後もデータを保持するための方法です。

### 1.1. `shared_preferences`

* **概要**: シンプルなキーバリュー形式で、軽量なデータを保存するのに適しています。設定情報やユーザーの好みなど、少量かつ構造化されていないデータによく利用されます。
* **特徴**:
    * 同期的にデータを読み書きできる。
    * プリミティブ型（String, int, bool, double, List<String>）のみ対応。
    * UIスレッドで直接アクセス可能だが、大量のデータや複雑なデータの保存には不向き。
* **ユースケース**: ユーザー設定（ダークモードのオンオフ）、ログイン状態の保持、簡単なキャッシュ。

### 1.2. `path_provider` とファイルシステム

* **概要**: デバイスのファイルシステム上に直接ファイルを保存する方法です。画像、音声、PDFなどの大きなバイナリデータや、複雑な構造のテキストデータを保存するのに適しています。`path_provider` パッケージで、プラットフォームごとの適切なパス（ドキュメントディレクトリ、キャッシュディレクトリなど）を取得します。
* **特徴**:
    * 任意の形式のデータを保存可能。
    * 非同期処理が必要。
    * ディレクトリやファイルの管理が必要。
* **ユースケース**: オフラインでの利用を目的としたメディアファイルの保存、カスタムログファイルの保存。

### 1.3. SQLite (パッケージ: `sqflite`)

* **概要**: リレーショナルデータベースSQLiteをFlutterアプリケーションに組み込むためのパッケージです。構造化された大量のデータを効率的に管理できます。
* **特徴**:
    * SQLクエリを使用してデータを操作。
    * トランザクションサポート。
    * データの検索、更新、削除が強力。
    * 非同期処理が必要。
* **ユースケース**: オフラインで利用する製品リスト、ユーザーの行動履歴、ローカルキャッシュとして利用するAPIデータ。

### 1.4. Isar / Hive (NoSQLデータベース)

* **概要**: Flutterに特化したNoSQLデータベース。SQLiteよりも高速で、オブジェクト指向のAPIを提供します。複雑なデータ構造を直接保存しやすいのが特徴です。
* **特徴**:
    * キーバリュー型だが、オブジェクト（JSONライクなデータ）を直接保存・取得できる。
    * 非常に高速な読み書き性能。
    * スキーマの柔軟性が高い。
    * 非同期処理。
* **ユースケース**: 大量の設定データ、オフラインでの利用を想定したユーザーデータ、複雑なオブジェクトのキャッシュ。

## 2. ネットワークアクセス (Web API)

外部のサーバーからデータを取得・送信する方法です。

### 2.1. `http` パッケージ

* **概要**: HTTPリクエスト（GET, POST, PUT, DELETEなど）を送信するための公式推奨パッケージです。RESTful APIとの連携に最も一般的に利用されます。
* **特徴**:
    * シンプルなAPIでHTTP通信を実現。
    * 非同期処理 (`Future` ベース)。
    * レスポンスのボディは通常JSON形式で返されるため、`dart:convert` の `jsonDecode` などでパースが必要。
* **ユースケース**: サーバーからのデータ取得、フォームデータの送信、認証情報の送受信。

### 2.2. `dio` パッケージ (HTTPクライアント)

* **概要**: `http` パッケージよりも高機能なHTTPクライアント。インターセプター、フォームデータサポート、タイムアウト、ダウンロード/アップロードの進捗管理など、より多くの機能を提供します。
* **特徴**:
    * HTTPリクエストのカスタマイズが容易。
    * エラーハンドリングが強化されている。
    * 大量のファイル操作や複雑なAPI連携に適している。
* **ユースケース**: 大規模なアプリケーションにおけるAPI連携、ファイルアップロード/ダウンロード。

### 2.3. WebSocket (パッケージ: `web_socket_channel`)

* **概要**: サーバーとクライアント間で永続的な双方向通信を確立するためのプロトコル。リアルタイムなデータ送受信に適しています。
* **特徴**:
    * クライアントとサーバー間で常に接続が維持される。
    * 低遅延でリアルタイム性が高い。
    * ストリーム（`Stream`）としてデータを送受信。
* **ユースケース**: チャットアプリケーション、株価のリアルタイム更新、ゲームの状態同期。

## 3. その他のデータアクセス方法

### 3.1. Provider / BLoC / Riverpod などの状態管理

* **概要**: 厳密にはデータアクセスそのものではなく、**取得したデータをアプリケーション全体でどのように共有・管理するか**という概念です。これらのパッケージは、データのライフサイクルやUIとの連携を効率化します。
* **特徴**:
    * UIとデータの分離。
    * データのフローを明確化し、保守性を高める。
    * UIの再構築を最適化し、パフォーマンスを向上させる。
* **ユースケース**: アプリケーションの状態（ログイン情報、選択中のアイテムなど）、APIから取得したデータのUIへの反映。

### 3.2. Firebase (Cloud Firestore / Realtime Database / Cloud Storage)

* **概要**: Googleが提供するモバイル・Webアプリケーション開発プラットフォーム。サーバーサイドの知識がなくても、クラウド上でデータベース、認証、ストレージなどを簡単に利用できます。
* **特徴**:
    * リアルタイム同期データベース（Firestore / Realtime Database）。
    * スケーラビリティが高い。
    * オフラインサポート。
    * 認証機能、ファイルストレージなども統合されている。
* **ユースケース**: リアルタイムな共同作業アプリ、バックエンドを自前で構築したくない場合のデータベース利用、ユーザー認証。

---

### データアクセスについてのまとめ

Flutter 3におけるデータアクセスは、**データの永続化**（`shared_preferences`、ファイルシステム、SQLite、Isar/Hive）、**ネットワーク通信**（`http`、`dio`、WebSocket）、そして**クラウドサービスや状態管理**（Firebase、Provider/BLoC/Riverpod）の大きく3つのカテゴリに分けられます。

どの方法を選ぶかは、保存したいデータの種類や量、リアルタイム性の要否、そしてオフライン対応の有無など、アプリケーションの具体的な要件によって異なります。これらのツールを適切に組み合わせることで、効率的で堅牢なFlutterアプリケーションを開発できます。